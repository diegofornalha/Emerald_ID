{"version":3,"file":"actor.umd.js","sources":["../src/mailbox/index.js","../src/index.js"],"sourcesContent":["export const mailbox = () => {\n  const queue = []\n  var next\n\n  return {\n    async deliver(msg) {\n      queue.push(msg)\n      if (next) {\n        next(queue.shift())\n        next = undefined\n      }\n    },\n\n    receive() {\n      return new Promise(function innerReceive(resolve) {\n        const msg = queue.shift()\n        if (msg) return resolve(msg)\n        next = resolve\n      })\n    },\n  }\n}\n","import {mailbox as createMailbox} from \"./mailbox\"\nimport queueMicrotask from \"queue-microtask\"\n\nexport const INIT = \"INIT\"\nexport const SUBSCRIBE = \"SUBSCRIBE\"\nexport const UNSUBSCRIBE = \"UNSUBSCRIBE\"\nexport const UPDATED = \"UPDATED\"\nexport const SNAPSHOT = \"SNAPSHOT\"\nexport const EXIT = \"EXIT\"\nexport const TERMINATE = \"TERMINATE\"\n\nconst root =\n  (typeof self === \"object\" && self.self === self && self) ||\n  (typeof global === \"object\" && global.global === global && global) ||\n  (typeof window === \"object\" && window.window === window && window)\n\nroot.FCL_REGISTRY = root.FCL_REGISTRY == null ? {} : root.FCL_REGISTRY\nvar pid = 0b0\n\nconst DEFAULT_TIMEOUT = 5000\nconst DEFAULT_TAG = \"---\"\nexport const send = (addr, tag, data, opts = {}) =>\n  new Promise((reply, reject) => {\n    const expectReply = opts.expectReply || false\n    const timeout = opts.timeout != null ? opts.timeout : DEFAULT_TIMEOUT\n\n    if (expectReply && timeout) {\n      setTimeout(\n        () =>\n          reject(new Error(`Timeout: ${timeout}ms passed without a response.`)),\n        timeout\n      )\n    }\n\n    const payload = {\n      to: addr,\n      from: opts.from,\n      tag,\n      data,\n      timeout,\n      reply,\n      reject,\n    }\n\n    try {\n      root.FCL_REGISTRY[addr] &&\n        root.FCL_REGISTRY[addr].mailbox.deliver(payload)\n      if (!expectReply) reply(true)\n    } catch (error) {\n      console.error(\n        \"FCL.Actor -- Could Not Deliver Message\",\n        payload,\n        root.FCL_REGISTRY[addr],\n        error\n      )\n    }\n  })\n\nexport const kill = addr => {\n  delete root.FCL_REGISTRY[addr]\n}\n\nconst fromHandlers = (handlers = {}) => async ctx => {\n  if (typeof handlers[INIT] === \"function\") await handlers[INIT](ctx)\n  __loop: while (1) {\n    const letter = await ctx.receive()\n    try {\n      if (letter.tag === EXIT) {\n        if (typeof handlers[TERMINATE] === \"function\") {\n          await handlers[TERMINATE](ctx, letter, letter.data || {})\n        }\n        break __loop\n      }\n      await handlers[letter.tag](ctx, letter, letter.data || {})\n    } catch (error) {\n      console.error(`${ctx.self()} Error`, letter, error)\n    } finally {\n      continue __loop\n    }\n  }\n}\n\nexport const spawn = (fn, addr = null) => {\n  if (addr == null) addr = ++pid\n  if (root.FCL_REGISTRY[addr] != null) return addr\n\n  root.FCL_REGISTRY[addr] = {\n    addr,\n    mailbox: createMailbox(),\n    subs: new Set(),\n    kvs: {},\n  }\n\n  const ctx = {\n    self: () => addr,\n    receive: () => root.FCL_REGISTRY[addr].mailbox.receive(),\n    send: (to, tag, data, opts = {}) => {\n      opts.from = addr\n      return send(to, tag, data, opts)\n    },\n    sendSelf: (tag, data, opts) => {\n      if (root.FCL_REGISTRY[addr]) send(addr, tag, data, opts)\n    },\n    broadcast: (tag, data, opts = {}) => {\n      opts.from = addr\n      for (let to of root.FCL_REGISTRY[addr].subs) send(to, tag, data, opts)\n    },\n    subscribe: sub => sub != null && root.FCL_REGISTRY[addr].subs.add(sub),\n    unsubscribe: sub => sub != null && root.FCL_REGISTRY[addr].subs.delete(sub),\n    subscriberCount: () => root.FCL_REGISTRY[addr].subs.size,\n    hasSubs: () => !!root.FCL_REGISTRY[addr].subs.size,\n    put: (key, value) => {\n      if (key != null) root.FCL_REGISTRY[addr].kvs[key] = value\n    },\n    get: (key, fallback) => {\n      const value = root.FCL_REGISTRY[addr].kvs[key]\n      return value == null ? fallback : value\n    },\n    delete: key => {\n      delete root.FCL_REGISTRY[addr].kvs[key]\n    },\n    update: (key, fn) => {\n      if (key != null)\n        root.FCL_REGISTRY[addr].kvs[key] = fn(root.FCL_REGISTRY[addr].kvs[key])\n    },\n    keys: () => {\n      return Object.keys(root.FCL_REGISTRY[addr].kvs)\n    },\n    all: () => {\n      return root.FCL_REGISTRY[addr].kvs\n    },\n    where: pattern => {\n      return Object.keys(root.FCL_REGISTRY[addr].kvs).reduce((acc, key) => {\n        return pattern.test(key)\n          ? {...acc, [key]: root.FCL_REGISTRY[addr].kvs[key]}\n          : acc\n      }, {})\n    },\n    merge: (data = {}) => {\n      Object.keys(data).forEach(\n        key => (root.FCL_REGISTRY[addr].kvs[key] = data[key])\n      )\n    },\n  }\n\n  if (typeof fn === \"object\") fn = fromHandlers(fn)\n\n  queueMicrotask(async () => {\n    await fn(ctx)\n    kill(addr)\n  })\n\n  return addr\n}\n\n// Returns an unsubscribe function\n// A SUBSCRIBE handler will need to be created to handle the subscription event\n//\n//  [SUBSCRIBE]: (ctx, letter) => {\n//    ctx.subscribe(letter.from)\n//    ctx.send(letter.from, UPDATED, ctx.all())\n//  }\n//\nexport function subscriber(address, spawnFn, callback) {\n  spawnFn(address)\n  const EXIT = \"@EXIT\"\n  const self = spawn(async ctx => {\n    ctx.send(address, SUBSCRIBE)\n    while (1) {\n      const letter = await ctx.receive()\n      if (letter.tag === EXIT) {\n        ctx.send(address, UNSUBSCRIBE)\n        return\n      }\n      callback(letter.data)\n    }\n  })\n  return () => send(self, EXIT)\n}\n\n// Returns a promise that returns a result\n// A SNAPSHOT handler will need to be created to handle the snapshot event\n//\n//  [SNAPSHOT]: (ctx, letter) => {\n//    letter.reply(ctx.all())\n//  }\n//\nexport function snapshoter(address, spawnFn) {\n  spawnFn(address)\n  return send(address, SNAPSHOT, null, {expectReply: true, timeout: 0})\n}\n"],"names":["mailbox","queue","next","deliver","msg","push","shift","undefined","receive","Promise","innerReceive","resolve","body","recover","result","e","then","finalizer","bind","pact","state","value","s","v","o","observer","prototype","onFulfilled","onRejected","callback","_this","thenable","test","update","stage","shouldContinue","updateValue","reject","_resumeAfterTest","_resumeAfterBody","_resumeAfterUpdate","INIT","SUBSCRIBE","UNSUBSCRIBE","UPDATED","SNAPSHOT","EXIT","TERMINATE","root","self","global","window","FCL_REGISTRY","pid","DEFAULT_TIMEOUT","send","addr","tag","data","opts","reply","expectReply","timeout","setTimeout","Error","payload","to","from","error","console","kill","fromHandlers","handlers","ctx","letter","spawn","fn","createMailbox","subs","Set","kvs","sendSelf","broadcast","subscribe","sub","add","unsubscribe","subscriberCount","size","hasSubs","put","key","get","fallback","keys","Object","all","where","pattern","reduce","acc","merge","forEach","queueMicrotask","subscriber","address","spawnFn","snapshoter"],"mappings":"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"}